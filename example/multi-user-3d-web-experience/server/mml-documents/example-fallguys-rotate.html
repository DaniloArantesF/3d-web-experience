<m-group id="rotate-group" ry="90" x="0.7"></m-group>
<script>
  const rotateGroup = document.getElementById("rotate-group");

  function spin(element, duration, clockWise = true) {
    const anim = document.createElement("m-attr-anim");
    anim.setAttribute("attr", "ry");
    anim.setAttribute("start", clockWise ? 0 : 360);
    anim.setAttribute("end", clockWise ? 360 : 0);
    anim.setAttribute("duration", duration);
    anim.setAttribute("start-time", document.timeline.currentTime);
    element.appendChild(anim);
  }

  function createSpinner(x, y, z, clockWise = true) {
    const spinner = document.createElement("m-model");
    spinner.setAttribute("src", "/assets/playground/fg_circle_clean.glb");
    spinner.setAttribute("x", x);
    spinner.setAttribute("y", y);
    spinner.setAttribute("z", z);
    spinner.setAttribute("rx", clockWise ? 180 : 0);
    spinner.setAttribute("rz", clockWise ? 180 : 0);
    return spinner;
  }

  function createSpinnersInHexGrid(y, width, depth, fullRotationTime) {
    const spinnerRadius = 3.4999;
    const spinnerDiameter = spinnerRadius * 2;
    const hexHeight = (spinnerDiameter * Math.sqrt(3)) / 2;
    const numSpinnersX = Math.floor(width / spinnerDiameter);
    const numSpinnersZ = Math.floor(depth / hexHeight);

    const totalWidth = numSpinnersX * spinnerDiameter + spinnerRadius;
    const totalDepth = numSpinnersZ * hexHeight;
    const halfTotalWidth = totalWidth / 2;
    const halfRadius = spinnerRadius / 2;

    for (let j = 0; j < numSpinnersZ; j++) {
      for (let i = 0; i < numSpinnersX; i++) {
        const ccw = (i + j) % 2 === 0;
        const xOffset = (j % 2) * spinnerRadius;
        const x = i * spinnerDiameter + xOffset - halfTotalWidth + halfRadius;
        const z = j * hexHeight - totalDepth / 2 + halfRadius;
        const spinner = createSpinner(x, y, z, ccw);
        spin(spinner, fullRotationTime, true);
        rotateGroup.appendChild(spinner);
      }
    }
  }

  createSpinnersInHexGrid(0, 42, 19, 2900);
</script>
