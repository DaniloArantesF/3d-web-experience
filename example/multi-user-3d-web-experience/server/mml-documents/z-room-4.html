<m-group id="game-room-group"></m-group>
<m-frame src="wss:///mml-documents/example-fallguys.html" y="200"></m-frame>

<script>
  const gameRoomGroup = document.getElementById("game-room-group");

  function animate(element, attr, start, end, duration, easing) {
    const anim = document.createElement("m-attr-anim");
    anim.setAttribute("attr", attr);
    anim.setAttribute("start", start);
    anim.setAttribute("end", end);
    anim.setAttribute("start-time", document.timeline.currentTime);
    anim.setAttribute("end-time", document.timeline.currentTime + duration);
    anim.setAttribute("duration", duration);
    anim.setAttribute("easing", easing);
    anim.setAttribute("loop", false);
    element.appendChild(anim);
    setTimeout(() => {
      element.setAttribute(attr, end);
      element.removeChild(anim);
    }, duration);
    return anim;
  }

  function createTeleporter(posX, posY, posZ, targetY) {
    const usersColliding = new Set();

    const teleporterStart = document.createElement("m-model");
    teleporterStart.setAttribute("src", "/assets/playground/teleporter_base.glb")
    teleporterStart.setAttribute("x", posX);
    teleporterStart.setAttribute("y", posY);
    teleporterStart.setAttribute("z", posZ);

    const transporter = document.createElement("m-model");
    transporter.setAttribute("src", "/assets/playground/teleporter_platform_emissive.glb");
    transporter.setAttribute("opacity", 0.0);
    teleporterStart.appendChild(transporter)

    const teleporterEnd = document.createElement("m-model");
    teleporterEnd.setAttribute("src", "/assets/playground/teleporter_base.glb")
    teleporterEnd.setAttribute("x", posX);
    teleporterEnd.setAttribute("y", posY + targetY);
    teleporterEnd.setAttribute("z", posZ + 10);
    teleporterStart.appendChild(teleporterEnd);

    const teleport = () => {
      setTimeout(() => {
        transporter.setAttribute("x", posX);
        transporter.setAttribute("y", targetY);
        transporter.setAttribute("z", posZ + 10);
        setTimeout(() => {
          animate(transporter, "y", targetY, targetY - 0.1, 2100, "EaseInOutCubic");
        }, 300);
        setTimeout(() => {
          transporter.setAttribute("x", 0);
          transporter.setAttribute("y", -0.1);
          transporter.setAttribute("z", 0);
          animate(transporter, "y", -0.1, 0, 2900, "EaseInOutCubic");
        }, 3000)
      }, 3000);
    }

    teleport();
    setInterval(() => {
      teleport();
    }, 6000)

    gameRoomGroup.appendChild(teleporterStart)
  }
  createTeleporter(0, 0, -7, 589.98);
</script>
