<m-group id="cubes"></m-group>
<m-group id="wall"></m-group>

<script>
  const cubesGroup = document.getElementById("cubes");
  const cubeCount = 20;
  const animAttrs = ["x", "y", "z", "sx", "sy", "sz"];
  function createAnimElement(container) {
    const animElement = document.createElement("m-attr-anim");
    animElement.setAttribute("attr", animAttrs[Math.floor(Math.random() * animAttrs.length)]);
    animElement.setAttribute("start", "1");
    animElement.setAttribute("end", "2");
    animElement.setAttribute("start-time", "1000");
    animElement.setAttribute("duration", "500");
    animElement.setAttribute("ping-pong", "true");
    animElement.setAttribute("easing", "easeInOutCubic");
    container.appendChild(animElement);
  }

  function createWall(x, y, z) {
    const wallElement = document.createElement("m-model");
    wallElement.setAttribute("src", "https://files.daarfi.me/cobblestone-wall.glb");
    wallElement.setAttribute("x", x);
    wallElement.setAttribute("y", y);
    wallElement.setAttribute("z", z);
    wallElement.setAttribute("instanced", "true");
    wallElement.setAttribute("collision-interval", "200");
    return wallElement;
  }

  function createCube() {
    const cubeElement = document.createElement("m-cube");
    cubeElement.setAttribute("y", Math.floor(Math.random() * cubeCount));
    cubeElement.setAttribute("x", Math.floor(Math.random() * cubeCount) + cubeCount / 2);
    cubeElement.setAttribute("z", Math.floor(Math.random() * cubeCount) + cubeCount / 2);
    cubeElement.setAttribute("instanced", "true");
    createAnimElement(cubeElement);

    cubeElement.addEventListener("click", (event) => {
      console.log(event);
    });
    return cubeElement;
  }

  for (let i = 0; i < cubeCount; i++) {
    cubesGroup.appendChild(createCube());
  }

  const wallGroup = document.getElementById("wall");
  for (let i = 0; i < cubeCount; i++) {
    const wall1 = createWall(0, 0, i * 2 + 0.75);
    wall1.setAttribute("ry", 90);
    const wall2 = createWall(cubeCount * 2, 0, i * 2 + 0.75);
    wall2.setAttribute("ry", 90);
    const wall3 = createWall(i * 2 + 0.75, 0, 0);
    const wall4 = createWall(i * 2 + 0.75, 0, cubeCount * 2);

    wallGroup.appendChild(wall1);
    wallGroup.appendChild(wall2);
    wallGroup.appendChild(wall3);
    wallGroup.appendChild(wall4);
  }
</script>
