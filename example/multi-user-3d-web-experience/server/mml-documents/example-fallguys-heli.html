<m-group id="helis-group"></m-group>
<script>
  const helisGroup = document.getElementById("helis-group");

  function spin(element, duration, clockWise = true) {
    const anim = document.createElement("m-attr-anim");
    anim.setAttribute("attr", "ry");
    anim.setAttribute("start", clockWise ? 0 : 360);
    anim.setAttribute("end", clockWise ? 360 : 0);
    anim.setAttribute("start-time", document.timeline.currentTime);
    anim.setAttribute("duration", duration);
    anim.setAttribute("loop", true);
    element.appendChild(anim);
    return anim;
  }

  function createHeli(left = false) {
    const heliGroup = document.createElement("m-group");
    const body = document.createElement("m-model");
    body.setAttribute("src", "/assets/playground/fg_heli_body.glb");
    heliGroup.appendChild(body);

    const heliBlade = document.createElement("m-model");
    heliBlade.setAttribute("src", "/assets/playground/fg_heli_blade.glb");
    spin(heliBlade, 200, left);
    heliGroup.appendChild(heliBlade);

    return heliGroup;
  }

  function createPingPongAnim(attr, start, end, startTime, duration, pingPongDelay) {
    const anim = document.createElement("m-attr-anim");
    anim.setAttribute("attr", attr);
    anim.setAttribute("start", start);
    anim.setAttribute("end", end);
    anim.setAttribute("start-time", startTime);
    anim.setAttribute("duration", duration);
    anim.setAttribute("ping-pong", true);
    anim.setAttribute("ping-pong-delay", pingPongDelay);
    return anim;
  }

  function createHelis() {
    const now = document.timeline.currentTime;
    for (let i = 0; i < 4; i++) {
      for (let j = 0; j < 2; j++) {
        const heli = createHeli(j === 0);
        heli.setAttribute("x", j % 2 === 0 ? -17 : 17);
        heli.setAttribute("z", -i * 8);

        const heliAnim = createPingPongAnim("y", 0, 0.5, now * -i * 300, 12000, 1200);
        heli.appendChild(heliAnim);
        helisGroup.appendChild(heli);
      }
    }
  }

  createHelis();
</script>
